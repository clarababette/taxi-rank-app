import{h as r,m as d}from"./vendor.07b059e9.js";const l=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}};l();var u=()=>({routes:[{destination:"Makhaza",people:[],taxis:[],departed:[]},{destination:"Belhar",people:[],taxis:[],departed:[]},{destination:"Bellville",people:[],taxis:[],departed:[]}],init(){localStorage.getItem("routes")&&(this.routes=JSON.parse(localStorage.getItem("routes"))),setInterval(()=>this.detailedRoutes,6e3)},routeIndex(e){return this.routes.findIndex(t=>t.destination==e)},addPerson(e){const t=this.routeIndex(e);this.routes[t].people=[...this.routes[t].people,new Date]},removePerson(e){const t=this.routeIndex(e);this.routes[t].people.shift()},addTaxi(e){const t=this.routeIndex(e);this.routes[t].taxis=[...this.routes[t].taxis,new Date]},updateQueue(e){let t=this.routes[e].people,n=this.routes[e].taxis,o=this.routes[e].departed;for(;Math.floor(t.length/11)>0&&n.length>0;)this.routes[e].departing=!0,new Promise((s,a)=>{setTimeout(()=>{s()},5e3)}).then(()=>{this.routes[e].departing=!1}),t.splice(0,11),n.shift(),this.routes[e].departed=[...o,r().toISOString()]},waitTime(e){const t=this.routes.find(o=>o.destination==e),n=t.people.reduce((o,i)=>o+r.duration(r().diff(r(i))).asMilliseconds(),0)/t.people.length;return r.duration(n,"milliseconds").humanize()},avgWaitTime(e){return this.waitTime(e)},recentlyDeparted(e){return e.filter(t=>r(t).isBetween(r().subtract(1,"hours"),r()))},get detailedRoutes(){return this.routes.map((e,t)=>(this.updateQueue(t),this.updateStorage(),{destination:e.destination,numPeople:e.people?e.people.length:0,nextTaxi:e.taxis[0]?r(e.taxis[0]).format("LT"):void 0,numTaxisWaiting:e.taxis.length,avgWaitTime:e.people[0]?this.avgWaitTime(e.destination):"There are no passengers waiting at this time.",numTaxisDeparted:e.departed?this.recentlyDeparted(e.departed).length:0,departing:e.departing?e.destination:!1}))},updateStorage(){localStorage.setItem("routes",JSON.stringify(this.routes))}});window.Alpine=d;d.data("taxiRank",u);d.start();
